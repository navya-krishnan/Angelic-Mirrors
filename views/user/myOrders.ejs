<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description"
        content="Responsive Bootstrap4 Shop Template, Created by Imran Hossain from https://imransdesign.com/">

    <!-- title -->
    <title>Order Confirm</title>


    <style>
        .order-list {
            margin-top: -15%;
            margin-bottom: 3%;
            text-align: center;
            text-decoration: underline;
        }

        .order-border {
            border: 2px solid black;
            margin-bottom: 5%;
            width: 80%;
            margin-left: 10%;
        }

        .btn-grey {
            background-color: grey;
            color: white;
        }

        .rounded-btn {
            border-radius: 20px;
        }
    </style>

    <!-- favicon -->
    <link rel="shortcut icon" type="image/png" href="/assets/img/favicon.png">
    <!-- google font -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
    <!-- fontawesome -->
    <link rel="stylesheet" href="/assets/css/all.min.css">
    <!-- bootstrap -->
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css">
    <!-- owl carousel -->
    <link rel="stylesheet" href="/assets/css/owl.carousel.css">
    <!-- magnific popup -->
    <link rel="stylesheet" href="/assets/css/magnific-popup.css">
    <!-- animate css -->
    <link rel="stylesheet" href="/assets/css/animate.css">
    <!-- mean menu css -->
    <link rel="stylesheet" href="/assets/css/meanmenu.min.css">
    <!-- main style -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <!-- responsive -->
    <link rel="stylesheet" href="/assets/css/responsive.css">

</head>

<body>

    <!--PreLoader-->
    <div class="loader">
        <div class="loader-inner">
            <div class="circle"></div>
        </div>
    </div>
    <!--PreLoader Ends-->

    <!-- header -->
    <div class="top-header-area" id="sticker">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 col-sm-12 text-center">
                    <div class="main-menu-wrap">
                        <!-- logo -->
                        <div class="site-logo">
                            <a href="/user/home">
                                <img src="/image/logo.png" alt="">
                            </a>
                        </div>
                        <!-- logo -->

                        <!-- menu start -->
                        <nav class="main-menu">
                            <ul>
                                <li class="current-list-item"><a href="/">Home</a>
                                </li>
                                <!-- <li><a href="about.html">About</a></li>
                                <li><a href="#">Pages</a>
                                    <ul class="sub-menu">
                                        <li><a href="404.html">404 page</a></li>
										<li><a href="about.html">About</a></li>
										<li><a href="cart.html">Cart</a></li>
										<li><a href="checkout.html">Check Out</a></li>
										<li><a href="contact.html">Contact</a></li>
										<li><a href="news.html">News</a></li>
                                        <li><a href="/user/shop.ejs">Shop</a></li>
                                    </ul>
                                </li> -->
                                <li><a href="/shop">Shop</a>

                                <li>
                                    <div class="header-icons">
                                        <a class="shopping-cart" href="/cart"><i class="fas fa-shopping-cart"></i></a>
                                        <!-- <a class="mobile-hide search-bar-icon" href="#"><i
												class="fas fa-search"></i></a> -->

                                        <a href="/profile">
                                            <% if(loggedIn){%>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                    fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                                                    <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
                                                    <path fill-rule="evenodd"
                                                        d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1" />
                                                </svg>
                                                <%}%>
                                        </a>

                                        <a href="/logout">
                                            <% if(loggedIn){%>

                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                    fill="currentColor" class="bi bi-box-arrow-right"
                                                    viewBox="0 0 16 16" style="color: white;">
                                                    <path fill-rule="evenodd"
                                                        d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z" />
                                                    <path fill-rule="evenodd"
                                                        d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z" />
                                                </svg>

                                                <%}%>


                                        </a>
                                    </div>
                                </li>
                            </ul>
                        </nav>
                        <a class="mobile-show search-bar-icon" href="#"><i class="fas fa-search"></i></a>
                        <div class="mobile-menu"></div>
                        <!-- menu end -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end header -->

    <!-- search area -->
    <!-- <div class="search-area">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<span class="close-btn"><i class="fas fa-window-close"></i></span>
					<div class="search-bar">
						<div class="search-bar-tablecell">
							<h3>Search For:</h3>
							<input type="text" placeholder="Keywords">
							<button type="submit">Search <i class="fas fa-search"></i></button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div> -->
    <!-- end search arewa -->

    <!-- breadcrumb-section -->
    <div class="breadcrumb-section breadcrumb-bg">
        <div class="container">
        </div>
    </div>
    <!-- end breadcrumb section -->

    <!-- Order list start -->
    <div class="order-list">
        <h3 class="orderhead" style="margin-top:5% ;">My Orders</h3>
    </div>

    <div class="order-border" style="margin-top: 5%;">
        <div class="cart-table-wrap">
            <table class="cart-table">
                <thead class="cart-table-head">
                    <tr class="table-head-row">
                        <th class="product-orderid">Order Id</th>
                        <th class="product-name">Price</th>
                        <th class="product-price">Expected Date</th>
                        <th class="product-quantity">Satus</th>
                        <th class="product-payment">Payment Status</th>
                        <th class="product-total">Actions</th>
                    </tr>
                </thead>
                <% if (orders.length===0) { %>
                    <tbody>
                        <tr>
                            <td colspan="5">No orders available.</td>
                        </tr>
                    </tbody>
                    <% } else { %>
                        <tbody>
                            <% orders.forEach((order, index)=> { %>
                                <tr>
                                    <td>
                                        <% const orderId=order._id ? order._id.toString() : '' ; %>
                                            <% const lastFiveDigits=orderId.substr(-5); %>
                                                <% const hashedOrderId='#' .repeat(orderId.length - 5); %>
                                                    <% const displayOrderId=hashedOrderId + lastFiveDigits; %>
                                                        <%= displayOrderId %>
                                    </td>

                                    <td>
                                        <% let totalPrice=0; order.products.forEach((product)=> {
                                            if (product) {
                                            totalPrice += product.totalPrice;
                                            }
                                            }); %>
                                            Rs. <%= totalPrice %> /-
                                    </td>
                                    <td>
                                        <% if(order.orderDate) { %>
                                            <% const deliveryDurationInDays=7; %>
                                                <% const orderDate=new Date(order.orderDate); %>
                                                    <% const expectedDeliveryDate=new Date(orderDate.getTime() +
                                                        deliveryDurationInDays * 24 * 60 * 60 * 1000); %>
                                                        <%= expectedDeliveryDate.toLocaleDateString() %>
                                                            <% } %>
                                    </td>
                                    <td>
                                        <%= order.status %>
                                    </td>
                                    <td>
                                        <% if (order.paymentMethod==='Online' ) { %>
                                            Paid
                                            <% } else { %>
                                                <%= order.paymentStatus %>
                                                    <% } %>
                                    </td>
                                    <td>
                                        <% if (order.status==='Delivered' ) { %>
                                            <a href="#" class="boxed-btn return-btn"
                                                onclick="returnOrder('<%= order._id %>')"
                                                style="margin-bottom: 5%; padding: 2px 20px; background-color: green;">Return</a>
                                            <% }else if(order.status==='Returned' ){ %>
                                                <a href="#" class="disabled btn-success rounded-btn"
                                                    style="margin-bottom: 5%; padding: 2px 20px; cursor: not-allowed;">Returned</a>
                                                <% } else if (order.status !=='Cancelled' ) { %>
                                                    <a href="#" class="boxed-btn"
                                                        onclick="confirmCancelOrder('<%= order._id %>')"
                                                        style="margin-bottom: 5%; padding: 2px 20px;">Cancel</a>
                                                    <% } else { %>
                                                        <a href="#" class="disabled btn-danger rounded-btn"
                                                            style="margin-bottom: 5%; padding: 2px 20px; cursor: not-allowed;">Cancelled</a>
                                                        <% } %>
                                                            <a href="/orderDetails/<%= order._id %>" class="boxed-btn"
                                                                style="margin-bottom: 5%; padding: 2px 20px;">Details</a>
                                    </td>
                                </tr>
                                <% }) %>
                        </tbody>
                        <% } %>

            </table>

        </div>
        <!-- pagination -->
        <div class="row">
            <div class="col-lg-12 text-center">
                <div class="pagination-wrap">
                    <ul class="pagination" style="justify-content: center;">
                        <li class="page-item <%= page == 1 ? 'disabled' : '' %>">
                            <a class="page-link"
                                href="?page=<%= page - 1 %>&sortOption=<%= sortOption %>&order=<%= order %>&search=<%= search %>"
                                aria-label="Previous">
                                <span aria-hidden="true"><i class="icon-long-arrow-left"></i></span>Prev
                            </a>
                        </li>

                        <% for (let i=1; i <=totalPages; i++) { %>
                            <li class="page-item <%= page == i ? 'active' : '' %>">
                                <a class="page-link"
                                    href="?page=<%= i %>&sortOption=<%= sortOption %>&order=<%= order %>&search=<%= search %>">
                                    <%= i %>
                                </a>
                            </li>
                            <% } %>

                                <li class="page-item <%= page == totalPages ? 'disabled' : '' %>">
                                    <a class="page-link"
                                        href="?page=<%= page + 1 %>&sortOption=<%= sortOption %>&order=<%= order %>&search=<%= search %>"
                                        aria-label="Next">
                                        Next <span aria-hidden="true"><i class="icon-long-arrow-right"></i></span>
                                    </a>
                                </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- end of pagination -->

    </div>


    <!-- order list end -->



    <!-- footer -->
    <div class="footer-area">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-6">
                    <div class="footer-box about-widget">
                        <h2 class="widget-title">About us</h2>
                        <p>Discover the
                            Reflection of Perfection:
                            Collect Your Favourite
                            Mirrors Right Here!</p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="footer-box get-in-touch">
                        <h2 class="widget-title">Get in Touch</h2>
                        <ul>
                            <li>angelicmirrors@gmail.com</li>
                            <li>+00 111 222 3333</li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="footer-box pages">
                        <h2 class="widget-title">Pages</h2>
                        <ul>
                            <li><a href="index.html">Home</a></li>
                            <li><a href="about.html">About</a></li>
                            <li><a href="services.html">Shop</a></li>
                            <li><a href="news.html">News</a></li>
                            <li><a href="contact.html">Contact</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="footer-box subscribe">
                        <h2 class="widget-title">Subscribe</h2>
                        <p>Subscribe to our mailing list to get the latest updates.</p>
                        <form action="index.html">
                            <input type="email" placeholder="Email">
                            <button type="submit"><i class="fas fa-paper-plane"></i></button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end footer -->

    <!-- copyright -->
    <div class="copyright">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-md-12">
                    <p>Copyrights &copy; 2024 - Angelic Mirrors</a>, All Rights
                        Reserved.<br>
                    </p>
                </div>
                <div class="col-lg-6 text-right col-md-12">
                    <div class="social-icons">
                        <ul>
                            <li><a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
                            <li><a href="#" target="_blank"><i class="fab fa-twitter"></i></a></li>
                            <li><a href="#" target="_blank"><i class="fab fa-instagram"></i></a></li>
                            <li><a href="#" target="_blank"><i class="fab fa-linkedin"></i></a></li>
                            <li><a href="#" target="_blank"><i class="fab fa-dribbble"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end copyright -->

    <script>
        function confirmCancelOrder(orderId) {
            // Prompt the user for the reason of cancellation
            var reason = prompt("Please enter the reason for cancelling this order:");

            // If the user provides a reason and confirms the cancellation
            if (reason !== null && confirm("Are you sure you want to cancel this order?")) {
                // Redirect to the route with orderId and reason parameters
                window.location.href = "/cancelOrder/" + orderId + "?reason=" + encodeURIComponent(reason);
            }
        }
    </script>


    <script>
        function returnOrder(orderId) {
            if (confirm("Are you sure you want to return this order?")) {
                try {
                    fetch("/returnOrder/" + orderId, {
                        method: 'post',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            orderId: '<%= orderId %>'
                        })
                    })

                        .then(response => {
                            if (response.ok) {
                                console.log('Order returned');
                                window.location.href = '/myOrders';
                            } else {
                                console.log('Failed to return order');
                                alert('Failed to return order. Please try again later.');
                            }
                        })

                } catch (error) {
                    console.error("Error returning order:", error);
                }
            }
        }
    </script>


    <!-- jquery -->
    <script src="/assets/js/jquery-1.11.3.min.js"></script>
    <!-- bootstrap -->
    <script src="/assets/bootstrap/js/bootstrap.min.js"></script>
    <!-- count down -->
    <script src="/assets/js/jquery.countdown.js"></script>
    <!-- isotope -->
    <script src="/assets/js/jquery.isotope-3.0.6.min.js"></script>
    <!-- waypoints -->
    <script src="/assets/js/waypoints.js"></script>
    <!-- owl carousel -->
    <script src="/assets/js/owl.carousel.min.js"></script>
    <!-- magnific popup -->
    <script src="/assets/js/jquery.magnific-popup.min.js"></script>
    <!-- mean menu -->
    <script src="/assets/js/jquery.meanmenu.min.js"></script>
    <!-- sticker js -->
    <script src="/assets/js/sticker.js"></script>
    <!-- main js -->
    <script src="/assets/js/main.js"></script>

</body>

</html>